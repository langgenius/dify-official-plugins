# Dify 用 Notion プラグイン

## 概要

Dify 用 Notion プラグインは、Notion ワークスペースとの統合を提供し、Dify アプリケーションから直接、検索、データベースのクエリ、ページの作成と更新を行うことができます。Dify 環境を離れることなく、Notion コンテンツとシームレスに対話することができます。

## 機能

- **Notion 検索**：キーワードで Notion ワークスペース内のページやデータベースを検索
- **データベースクエリ**：特定の Notion データベースからコンテンツを取得してフィルタリング
- **ページ作成**：カスタムタイトルとコンテンツで Notion ワークスペースに新しいページを作成
- **ページ取得**：ID で特定のページとそのコンテンツを取得
- **ページ更新**：既存のページのタイトルを更新、または新しいコンテンツを追加
- **データベース取得**：データベースの構造とスキーマ情報を取得
- **データベース作成**：カスタムプロパティとスキーマを持つ新しいデータベースを作成
- **データベース更新**：既存のデータベースのタイトルまたはプロパティを変更
- **コメント取得**：特定のページまたはブロックからコメントを取得
- **コメント作成**：Notion ページに新しいコメントを追加

## 設定

### 1. Notion でインテグレーションを設定

[Notion インテグレーション](https://www.notion.so/my-integrations)にアクセスして、新しい**内部**インテグレーションを作成するか、既存のものを選択します。

![](_assets/docs/integrations-creation.png)

インテグレーションに適切な名前を付け、接続するワークスペースを選択します。

セキュリティ上の理由から、インテグレーションの機能を制限することをお勧めします。例えば、「コンテンツを読む」権限のみを有効にして、読み取り専用のインテグレーションを作成できます：

![](_assets/docs/integrations-capabilities.png)

「Secrets」タブから「内部インテグレーションシークレット」をコピーします。これは Dify でプラグインを設定するために必要です。

**重要：**このシークレットは安全に保管してください。このトークンを持っている人は誰でも、インテグレーションと共有されているコンテンツにアクセスできます。

### 2. コンテンツをインテグレーションに接続

インテグレーションが特定のページやデータベースにアクセスするには、それらを明示的にインテグレーションと共有する必要があります：

1. プラグインを通じてアクセスしたいページまたはデータベースに移動
2. 右上隅の「•••」（三点）メニューをクリック
3. 「接続を追加」を選択し、リストからインテグレーションを選択

![](_assets/docs/connections.png)

プラグインでアクセスしたい各ページまたはデータベースに対してこのプロセスを繰り返します。

### 3. Dify でプラグインを設定

1. Dify ワークスペースで、プラグインセクションに移動
2. Notion プラグインを見つけて選択
3. 設定フィールドにインテグレーションシークレットを貼り付け
4. 設定を保存

## 使用例

### Notion 検索
```
「プロジェクト計画」を含む Notion ワークスペース内のページを検索
```

### データベースクエリ
```
ID が「abc123」の Notion データベース内で、ステータスが「進行中」のすべてのアイテムを表示
```

### ページ作成
```
「ミーティングメモ」というタイトルで、「プロジェクトのタイムラインについて議論し、タスクを割り当てた。」というコンテンツの新しい Notion ページを作成
```

### ページ取得
```
ID が「abc123」の Notion ページとそのコンテンツを取得
```

### ページ更新
```
Notion ページ「abc123」のタイトルを「更新されたミーティングメモ」に更新し、「来週フォローアップを予定」をコンテンツに追加
```

### データベース構造の取得
```
Notion データベース「abc123」の構造とプロパティを取得
```

### データベース作成
```
Notion ページ「abc123」に「プロジェクトタスク」というタイトルの新しいデータベースを作成し、名前（タイトル）、ステータス（選択）、期限（日付）のプロパティを含める
```

### データベース更新
```
Notion データベース「abc123」を更新して、「ステータス」プロパティを「進捗」に名前変更
```

### コメント取得
```
Notion ページ「abc123」からすべてのコメントを取得
```

### コメント作成
```
Notion ページ「abc123」に「このタスクは順調に進んでいます！」というコメントを追加
```

## サポートされている操作

1. **検索**：ワークスペース全体でページとデータベースを検索
2. **データベースクエリ**：特定のデータベースからレコードを取得してフィルタリング
3. **ページ作成**：タイトルとコンテンツを持つ新しいページを作成
4. **ページ取得**：プロパティとコンテンツブロックを含むページの詳細を取得
5. **ページ更新**：ページのタイトルを変更、または新しいコンテンツを追加
6. **データベース取得**：データベースの構造、スキーマ、プロパティタイプを取得
7. **データベース作成**：カスタムプロパティを持つ新しいデータベースを作成
8. **データベース更新**：データベースのタイトルを更新、またはプロパティを変更
9. **コメント取得**：ページまたはブロックからコメントを取得
10. **コメント作成**：ページにコメントを追加
11. **データ抽出**：リッチテキスト、選択、複数選択など、さまざまな Notion プロパティタイプを処理

## トラブルシューティング

- **認証エラー**：インテグレーショントークンが有効で期限切れでないことを確認してください
- **アクセスエラー**：インテグレーションが使用しようとしているページ/データベースへのアクセス権を付与されていることを確認してください
- **見つからないエラー**：データベースまたはページの ID が正しく、アクセス可能であることを確認してください
- **レート制限**：レート制限エラーが発生した場合、プラグインはバックオフを使用して自動的に再試行します
