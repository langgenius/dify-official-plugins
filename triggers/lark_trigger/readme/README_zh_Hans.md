# Lark Trigger 插件用户指南

## 此插件的功能

Lark Trigger 插件将您的 Dify 工作流与 Lark（飞书）事件连接起来。当您的 Lark 工作区中发生某事时 - 例如收到消息、创建文件或加入会议 - 此插件会自动启动您的 Dify 工作流来响应这些事件。

## 开始使用

### 步骤 1：设置您的 Lark 应用

1. 转到 [Lark Open Platform](https://open.larksuite.com/) 并创建一个新应用
2. 在您的应用设置中，查找并保存以下四条信息：
   - **App Credentials**: 可以在 `Credentials & Basic Info` 部分找到
      - **App ID**: 您应用的唯一标识符
      - **App Secret**: 您应用的密码（请妥善保管！）
   - **Event Subscriptions**: 可以在 `Events & Callbacks` 部分找到
      - **Encrypt Key**: 用于加密事件数据，在 Lark 中是可选的，但在此插件中是必需的
      - **Verification Token**: 用于确认事件确实来自 Lark

![Lark App Credentials](./_assets/ca5d4697947a8a42ca7c9cb132317525.png)
![Lark Event Subscriptions](./_assets/a5aca5b287802de21726742f702d89f2.png)

### 步骤 2：在 Lark 和 Dify 中配置事件订阅

1. 返回您的 Dify 插件页面并找到"Lark Trigger"插件，点击插件后您会发现 `Subscription` 部分
2. 填写您从 Lark 获取的凭据
![Lark Trigger Plugin](./_assets/8a92013e9ee55f32acc314ccbedb3ab5.png)
3. 注意：复制此处出现的 `Callback URL`，并向下滚动到对话框底部，`REQUEST LOGS` 是我们稍后需要检查的内容。
4. 转到您的 Lark 应用设置，找到 `Events & Callbacks` 部分，并将您的 Request URL 设置为从 Dify 获取的 `Callback URL`。
![Lark Event Subscriptions](./_assets/6b5dc8dd7d5ff70e1af7b157d303c1ae.png)
5. 最后一步，保存您的 Lark 应用设置，测试请求将发送到您的 Dify 工作区，您可以在我们之前提到的 `REQUEST LOGS` 部分看到该请求。
![Lark Request Logs](./_assets/526273bed474a96720504f866ef82baf.png)
6. 截图中是一个失败的例子，但不用担心，如果您正确遵循步骤，您将收到成功消息，只需点击 `create` 按钮保存您的设置。

### 步骤 3：在 Dify 工作流中使用

不要忘记选择正确的订阅和事件。

![Lark Trigger Plugin](./_assets/e8c150fb8d132270ed91cec395fe0d39.png)

## 可用事件

### 消息 & 聊天（IM）

#### 消息接收（`message_receive_v1`）

- **触发条件**: 在您的机器人所在的聊天中收到任何新消息
- **获取信息**: 消息内容、发送者详细信息、聊天信息、消息类型
- **示例用途**: 自动回复机器人、消息日志记录、关键字检测

#### 消息已读（`message_read_v1`）

- **触发条件**: 当用户阅读消息时
- **获取信息**: 阅读者信息、消息 ID、已读时间戳
- **示例用途**: 已读回执跟踪、参与度分析

#### 消息撤回（`message_recalled_v1`）

- **触发条件**: 当消息被撤回/撤销时
- **获取信息**: 撤回的消息 ID、撤回时间、操作者详细信息
- **示例用途**: 审计跟踪、合规监控

#### 消息表情添加（`message_reaction_added_v1`）

- **触发条件**: 当有人向消息添加表情符号反应时
- **获取信息**: 反应类型、消息 ID、反应者信息、操作时间
- **示例用途**: 情绪分析、投票跟踪、参与度指标

#### 消息表情删除（`message_reaction_deleted_v1`）

- **触发条件**: 当有人删除表情符号反应时
- **获取信息**: 已删除的反应详细信息、消息 ID、操作者信息
- **示例用途**: 反应变化跟踪、更新的情绪分析

#### 聊天更新（`chat_updated_v1`）

- **触发条件**: 当聊天组信息更改时
- **获取信息**: 更新的聊天详细信息、更改类型、操作者信息
- **示例用途**: 组设置监控、合规跟踪

#### 聊天解散（`chat_disbanded_v1`）

- **触发条件**: 当聊天组被解散/删除时
- **获取信息**: 聊天 ID、解散时间、操作者详细信息
- **示例用途**: 存档管理、清理工作流

#### 聊天成员用户添加（`chat_member_user_added_v1`）

- **触发条件**: 当用户被添加到群聊时
- **获取信息**: 新成员列表、聊天详细信息、操作者信息
- **示例用途**: 欢迎消息、访问配置

#### 聊天成员用户移除（`chat_member_user_removed_v1`）

- **触发条件**: 当用户从群聊中被移除时
- **获取信息**: 被移除的用户列表、聊天详细信息、操作者信息
- **示例用途**: 访问撤销、告别消息

#### 聊天成员用户退出（`chat_member_user_withdrawn_v1`）

- **触发条件**: 当用户主动离开群聊时
- **获取信息**: 用户详细信息、聊天信息、离开时间
- **示例用途**: 退出调查、成员跟踪

#### 聊天成员机器人添加（`chat_member_bot_added_v1`）

- **触发条件**: 当机器人被添加到群聊时
- **获取信息**: 机器人详细信息、聊天信息、操作者详细信息
- **示例用途**: 机器人初始化、配置设置

#### 聊天成员机器人删除（`chat_member_bot_deleted_v1`）

- **触发条件**: 当机器人从群聊中被移除时
- **获取信息**: 机器人详细信息、聊天信息、操作者详细信息
- **示例用途**: 清理任务、数据归档

### 文件 & 文档（Drive）

#### 文件创建（`file_created_v1`）

- **触发条件**: 当创建新文件或文档时
- **获取信息**: 文件详细信息、创建者信息、文件类型、位置
- **示例用途**: 自动分类、备份创建

#### 文件编辑（`file_edit_v1`）

- **触发条件**: 当文件被编辑时
- **获取信息**: 文件详细信息、编辑者信息、编辑时间戳
- **示例用途**: 版本跟踪、更改通知

#### 文件读取（`file_read_v1`）

- **触发条件**: 当文件被访问或查看时
- **获取信息**: 文件详细信息、阅读者信息、访问时间
- **示例用途**: 访问日志记录、流行度跟踪

#### 文件删除（`file_deleted_v1`）

- **触发条件**: 当文件被删除时
- **获取信息**: 文件详细信息、删除操作者、删除时间
- **示例用途**: 恢复工作流、审计日志

#### 文件移至回收站（`file_trashed_v1`）

- **触发条件**: 当文件被移至回收站时
- **获取信息**: 文件详细信息、操作者信息、回收站时间
- **示例用途**: 回收站监控、恢复提醒

#### 文件标题更新（`file_title_updated_v1`）

- **触发条件**: 当文件标题被更新时
- **获取信息**: 文件详细信息、更新者信息、新旧标题
- **示例用途**: 标题更改跟踪、命名规则检查
