# RssHub Trigger プラグイン

シンプルなWebhookを介してDifyでRssHubフィード通知を受信します。柔軟なイベント、豊富なフィルター、オプションの共有シークレット検証。

**このプラグインを使う理由**

- ポーリングを削減：フィードが変更されるとすぐにワークフローをトリガーします。
- ペイロードを正規化：標準のRSS/Atomフィールドまたはカスタム構造を渡します。
- シンプルに保つ：オプションのAPIキー、サーバー間のハンドシェイクは不要です。

**RSS Hubとは？**

- RSS Hubは、ウェブサイトやサービス用のRSS/Atomフィードを生成するオープンソースプロジェクトです。
- プロジェクトホームページ（GitHub）: https://github.com/DIYgod/RSSHub
- このプラグインはWebhook受信者です：`feed_update`ペイロードを受け入れ、Difyワークフローをトリガーします。

## 機能

- オプションのAPIキー検証（ヘッダーまたはクエリパラメータ）
- 適切なデフォルトを持つ複数のイベント
- ノイズを最小限に抑えるイベントごとの豊富なフィルター
- トリガー変数としての汎用アイテムペイロードパススルー

## アーキテクチャ

- 送信者：RssHubデプロイメント、フィードを読み取るcron/ワーカー、またはフィード更新をJSON POSTに変換する任意のスクリプト。
- 受信者：このプラグインのWebhook URL（トリガー用にDifyによって生成されます）。オプションで検証し、ワークフローにイベントをディスパッチします。

## セットアップ

1. プラグインをDifyにインストール/インポートします。
2. サブスクリプション設定：
   - `API Key`（オプション）：
     - 提供された場合、すべてのWebhook呼び出しには同じキーが含まれている必要があります（認証を参照）。
     - 空白のままにすると、Webhookは認証されていない投稿を受け入れます。
3. DifyトリガーからWebhookエンドポイントURLをコピーします。
4. RssHub（または小さなコンパニオンワーカー）を設定して、このURLに更新をPOSTします。
    ![RSS_WEBHOOK.png](_assets/RSS_WEBHOOK.png)
   - APIキーを使用している場合は、以下のように含めます。
5. （オプション）ヘッダー/クエリ/ボディ経由でカスタムイベント名を送信する場合、それは受け入れられますが、プラグインは`feed_update`用に最適化されています。

## 認証（オプション）

- サブスクリプションで共有`API Key`を提供して検証を有効にします。
- 次のいずれかを使用して、各リクエストで同じキーを送信します：
  - HTTPヘッダー `X-Api-Key: <your_api_key>`（推奨）
  - HTTPヘッダー `Authorization: Bearer <your_api_key>`
  - クエリ文字列 `?token=<your_api_key>` または `?api_key=<your_api_key>`
- サブスクリプションでAPIキーを設定しない場合、受信者は認証されていないリクエストを受け入れます。

## イベントタイプ

- `feed_update`
  - このプラグインは単一のイベント`feed_update`を使用し、このREADMEで説明されているペイロード構造を期待します。
  - 参考（プロジェクト）: https://github.com/DIYgod/RSSHub
  - 他のカスタムイベント名も受け入れられますが、スキーマ型ではありません。

## ペイロードスキーマ（rss.app）

プラグインは、トリガー変数として JSON本文全体を公開します。正規のスキーマは次のとおりです：

- `id`（string）：Webhookイベントの一意の識別子
- `type`（string）：イベントタイプ（現在は`feed_update`）
- `feed`（object）：フィードメタデータ
  - `id`（string）：フィードの一意の識別子
  - `title`（string）：フィードタイトル
  - `source_url`（string）：ソースウェブサイトURL
  - `rss_feed_url`（string）：RSSフィードXML URL
  - `description`（string）：フィードの説明
  - `icon`（string）：ファビコン/アイコンURL
- `data`（object）：更新の詳細
  - `items_new`（オブジェクトの配列）：最後のイベント以降の新しいアイテム
    - `url`（string）
    - `title`（string）
    - `description_text`（string）
    - `thumbnail`（string）
    - `date_published`（日付文字列）
    - `authors`（オブジェクトの配列）
      - `name`（string）
  - `items_changed`（オブジェクトの配列）：最後のイベント以降の更新されたアイテム
    - `url`（string）
    - `title`（string）
    - `description_text`（string）
    - `thumbnail`（string）
    - `date_published`（日付文字列）
    - `authors`（オブジェクトの配列）
      - `name`（string）

## ヒントとベストプラクティス

- 関心のあるものをキャプチャする最小限のフィルターセットを選択します；プラグインに残りをアップストリームで無視させます。
- 重複を避けるために、通知側でGUID/IDを正規化します。
- RssHubから直接プッシュできない場合は、フィード変更をWebhook POSTに変換する小さなポーラー（cron/ワーカー）を実行します。
- 認証されていないモードの場合、既知のソースIPのみを許可するか、リバースプロキシで秘密のパスセグメントを使用することをお勧めします。

## トラブルシューティング

- 実行なし：イベントタイプとフィルターを確認します；接続を検証するためにフィルターを削除してみてください。
- APIキーで401/403：サブスクリプションの`API Key`が送信するヘッダー/クエリと一致することを確認してください。
- 400解析エラー：`Content-Type: application/json`を確保するか、`payload` JSONフィールドを含むURLエンコードを送信してください。
- イベント不一致：ヒューリスティックフォールバックを避けるために、イベントを明示的に指定します（ヘッダーまたはクエリ）。

## 制限事項

- このプラグインはRssHubサブスクリプションを作成/管理しません。デプロイメントまたはコンパニオンワーカーからのプッシュを設定してください。
- 共有シークレットスタイルの検証のみがサポートされています；現時点ではOAuth/HMACはありません。
