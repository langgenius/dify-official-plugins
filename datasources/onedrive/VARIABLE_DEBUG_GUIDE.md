# 变量调试指南

## 🔍 **知识库没有变量的完整解决方案**

### 问题诊断清单

#### ✅ 第一步：检查节点连接
```
Pipeline连接检查:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ OneDrive    │───▶│文档处理器    │───▶│  知识库     │
│ 数据源      │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘

连线检查项:
□ OneDrive → 文档处理器 有连线
□ 文档处理器 → 知识库 有连线
□ 连线颜色正常（非红色错误状态）
```

#### ✅ 第二步：验证节点配置
```yaml
OneDrive节点配置:
  节点名称: onedrive_docs        # 记住这个名称！
  文件ID: 4C588C50361D50A3!857
  状态: ✅ 执行成功

文档处理器节点配置:  
  节点名称: doc_processor        # 记住这个名称！
  输入源: {{onedrive_docs.result}}
  状态: ✅ 执行成功

知识库节点配置:
  节点名称: knowledge_base
  文档源: {{doc_processor.documents}}  # 这里应该有值！
```

#### ✅ 第三步：变量引用语法检查
```javascript
正确的变量引用格式:

// OneDrive节点输出
{{onedrive_docs.result}}              ✅ 正确
{{OneDrive_docs.result}}              ❌ 大小写错误
{{onedrive-docs.result}}              ❌ 连字符错误
{{onedrive_docs}}                     ❌ 缺少.result

// 文档处理器输出  
{{doc_processor.documents}}           ✅ 正确
{{doc_processor.result}}              ❌ 应该是documents
{{document_processor.documents}}      ❌ 节点名称错误
```

## 🚨 **常见错误和解决方案**

### 错误1：节点名称不匹配
```
问题: 变量引用中的节点名称与实际节点名称不一致

解决: 
1. 双击节点查看实际名称
2. 确保变量引用使用相同名称
3. 节点名称不能包含空格和特殊字符
```

### 错误2：变量路径错误
```
问题: {{onedrive.documents}} - 错误的输出字段

正确路径:
- OneDrive数据源: {{节点名.result}}
- 文档处理器: {{节点名.documents}}  
- 知识库: {{节点名.context}}
```

### 错误3：节点执行顺序问题
```
问题: 下游节点在上游节点执行完成前就尝试获取变量

解决:
1. 确保Pipeline按顺序执行
2. 检查是否有循环依赖
3. 使用调试模式逐步执行
```

## 🔧 **实际操作修复步骤**

### 步骤1：重新配置知识库节点
1. 双击知识库节点打开配置
2. 在"文档源"字段中输入: `{{doc_processor.documents}}`
3. 确保节点名称`doc_processor`与实际文档处理器名称一致
4. 保存配置

### 步骤2：验证变量是否出现
```
配置完成后，知识库节点应该显示:
┌─────────────────────────┐
│ 输入变量                │
├─────────────────────────┤  
│ ✅ doc_processor.documents │
│    来自: 文档处理器      │
└─────────────────────────┘
```

### 步骤3：测试运行
1. 点击Pipeline的"运行"按钮
2. 观察每个节点的执行状态
3. 检查知识库节点是否接收到文档数据

## 🎯 **快速修复指令**

### 如果仍然没有变量显示:

```yaml
立即检查项:
1. 文档处理器节点是否执行成功? 
   - 查看节点状态指示灯
   - 点击节点查看输出内容

2. 变量名称是否完全匹配?
   - 检查节点实际名称
   - 确认大小写正确

3. 是否使用了正确的输出字段?
   - OneDrive: .result
   - 文档处理器: .documents
   - 知识库: .context
```

### 终极解决方案:
```
如果以上都不行，重新创建连接:
1. 删除所有节点之间的连线
2. 重新从OneDrive拖拽连线到文档处理器  
3. 再从文档处理器拖拽连线到知识库
4. 重新配置各节点的输入变量
```

## 🔍 **调试技巧**

### 使用Pipeline调试模式:
1. 启用"调试模式"
2. 逐个节点执行
3. 查看每个节点的输出数据
4. 确认数据在每一步都正确传递

### 检查变量数据结构:
```json
OneDrive节点输出结构:
{
  "result": {
    "content": "文件二进制数据",
    "meta": {
      "file_name": "document.pdf",
      "mime_type": "application/pdf"
    }
  }
}

文档处理器输出结构:
{
  "documents": [
    {
      "content": "提取的文本内容",
      "metadata": {...}
    }
  ]
}
```
